generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN_TENANT
  SUB_RESELLER
}

enum OrderStatus {
  PENDING
  PAID
  CANCELED
}

enum TransactionType {
  CREDIT_IN
  CREDIT_OUT
}

model Tenant {
  id             String    @id @default(uuid())
  name           String
  slug           String    @unique
  brandColor     String?   @map("brand_color")
  logoUrl        String?   @map("logo_url")
  warezUsername  String?   @map("warez_username")
  warezPassword  String?   @map("warez_password")
  monnifyToken   String?   @map("monnify_token")
  monnifyWebhookSecret String? @map("monnify_webhook_secret")
  createdAt      DateTime  @default(now()) @map("created_at")

  users          User[]
  products       Product[]
  orders         Order[]

  @@map("tenants")
}

model User {
  id        String   @id @default(uuid())
  tenantId  String   @map("tenant_id")
  email     String
  password  String
  role      UserRole
  balance   Decimal  @default(0)

  tenant    Tenant   @relation(fields: [tenantId], references: [id])
  orders    Order[]

  @@unique([tenantId, email])
  @@index([tenantId])
  @@map("users")
}

model Product {
  id             String   @id @default(uuid())
  tenantId       String   @map("tenant_id")
  name           String
  price          Decimal
  creditsAmount  Int      @map("credits_amount")
  active         Boolean  @default(true)

  tenant         Tenant   @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@map("products")
}

model Order {
  id           String       @id @default(uuid())
  tenantId     String       @map("tenant_id")
  userId       String       @map("user_id")
  totalAmount  Decimal      @map("total_amount")
  status       OrderStatus  @default(PENDING)
  paymentId    String?      @map("payment_id")
  createdAt    DateTime     @default(now()) @map("created_at")

  tenant       Tenant       @relation(fields: [tenantId], references: [id])
  user         User         @relation(fields: [userId], references: [id])
  transactions Transaction[]

  @@index([tenantId])
  @@index([userId])
  @@map("orders")
}

model Transaction {
  id        String           @id @default(uuid())
  orderId   String           @map("order_id")
  type      TransactionType
  createdAt DateTime         @default(now()) @map("created_at")

  order     Order            @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@map("transactions")
}
